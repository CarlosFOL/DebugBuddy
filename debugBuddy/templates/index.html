<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Skills Explorer</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../static/css/main.css">
    
</head>
<body>

  <!-- HEADER -->
  <header class="py-3 sticky-top">
    <div class="container d-flex align-items-center justify-content-between">
      <a href="index.html" class="d-flex align-items-center text-decoration-none">
        <img src="../static/img/logo.jpeg" alt="Logo" class="logo me-2">
        <span class="h5 m-0">DebugBuddy</span>
      </a>
      <div class="flex-grow-1 mx-3 search-bar">
        <input type="search" id="searchInput" class="form-control" placeholder="Buscar skills...">
      </div>
    </div>
  </header>

  <!-- CONTENIDO PRINCIPAL -->
  <main class="container mt-5 pt-5">
    <!-- Filtros: Categoría y Especialidad -->
    <div class="row mb-4">
      <div class="col-md-6">
        <label for="categorycb" class="form-label">Categoría</label>
        <select id="categorycb" class="form-select">
          <option value="" selected>Seleccione categoría</option>
          {% for cat in categories %}
            <option value="{{cat[0]}}">{{cat[1]}}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-6">
        <label for="subcatcb" class="form-label">Especialidad</label>
        <select id="subcatcb" class="form-select">
          <option value="" selected>Seleccione especialidad</option>
        </select>
      </div>
    </div>

    <!-- Contenedor de Cards de Skills -->
    <div id="skills_container" class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-4">
      <!-- Aquí se inyectarán dinámicamente las cards de skills -->
    </div>
  
    <script>
      function fetchButtons(){
        const container = document.getElementById("skills_container")
        fetch("/get_issues").
        then(response => response.json())
        .then(skills => {
            skills.forEach(skill => {
              // Crear card usando clases de Bootstrap
              const col = document.createElement("div");
              col.className = "col";
              const card = document.createElement("div");
              card.className = "card h-100";
              const cardBody = document.createElement("div");
              cardBody.className = "card-body d-flex align-items-center justify-content-center";
              const button = document.createElement("button");
              button.className = "btn btn-primary";
              button.textContent = skill[1];  
              button.dataset.skillId = skill[0]; 
              button.addEventListener("click", () => {
                    window.location.href = `/skill/${button.dataset.skillId}`;
                });

              cardBody.appendChild(button);
              card.appendChild(cardBody);
              col.appendChild(card);
              container.appendChild(col);
            });
          })
      }
      fetchButtons()
    </script>

  </main>

    <!-- Bootstrap Bundle JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Script para funcionalidad -->
  <script>
    // Actualizar especialidades según la categoría seleccionada
    document.getElementById('categorycb').addEventListener('change', function() {
      fetchButtons()
      const categoryId = this.value;
      const subcatComboBox = document.getElementById('subcatcb');
      if (categoryId) { 
        fetch(`/get_subcategories/${categoryId}`)
          .then(response => response.json())
          .then(subcategories => {
            subcatComboBox.innerHTML = '<option value="" selected>Seleccione especialidad</option>';
            subcategories.forEach(subcat => {
              const optionElement = document.createElement('option');
              optionElement.value = subcat[0];
              optionElement.textContent = subcat[1];
              subcatComboBox.appendChild(optionElement);
            });
          });
      } else {
        subcatComboBox.innerHTML = '<option value="" selected>Seleccione especialidad</option>';
        fetchButtons()
      }
    });

    // Cargar skills en forma de cards al seleccionar una especialidad
    document.getElementById("subcatcb").addEventListener('change', function() {
      const subcatId = this.value;
      const container = document.getElementById("skills_container");
      if (subcatId) {
        container.innerHTML = '';
        fetch(`/get_issues?p_subcat=${subcatId}`)
          .then(response => response.json())
          .then(skills => {
            skills.forEach(skill => {
              // Crear card usando clases de Bootstrap
              const col = document.createElement("div");
              col.className = "col";
              const card = document.createElement("div");
              card.className = "card h-100";
              const cardBody = document.createElement("div");
              cardBody.className = "card-body d-flex align-items-center justify-content-center";
              // Create a button instead of just a title
              const button = document.createElement("button");
              button.className = "btn btn-primary";
              button.textContent = skill[1];  
              button.dataset.skillId = skill[0]; 
              button.addEventListener("click", () => {
                    window.location.href(`/skill/${button.dataset.skillId}`);
                });

              cardBody.appendChild(button);
              card.appendChild(cardBody);
              col.appendChild(card);
              container.appendChild(col);
            });
          });
      }
    });

    // Filtro de búsqueda en las cards
    document.getElementById('searchInput').addEventListener('input', function() {
      const filter = this.value.toLowerCase();
      document.querySelectorAll('#skills_container .card').forEach(card => {
        card.parentElement.style.display = card.textContent.toLowerCase().includes(filter) ? '' : 'none';
      });
    });
  </script>
</body>
</html>
